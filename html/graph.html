<html>
<head>
    <meta charset="utf-8">
    <title>Data Graph</title>
    <script type="text/javascript" src="js/jquery.js"></script>
    <script src="js/echarts.js"></script>
    <style>
        .contaier{
            width: 70%;
            text-align: center;
            margin: auto;
        }
        .chart{
            height: 300px;
            width: 50%;
            float: left;  
        }
    </style>
</head>
<body>
    <div class="contaier">
        <div id="chart1" class="chart"></div>
        <div id="chart2" class="chart"></div>
        <div id="chart3" class="chart"></div>
        <div id="chart4" class="chart"></div>
        <div id="chart5" class="chart"></div>
        <div id="chart6" class="chart"></div>
    <div>
    <script type="text/javascript">
        var uuid = "ba16b497-d49d-4a0b-a00b-246209076bfa"
        var stime = '2015-11-15'
        var etime = '2015-11-16'

        var time = []
        // 1
        var cpu_usage = []
        // 2
        var memory_usage = []
        // 3
        var rx_packets = []
        var tx_packets = []
        // 4
        var rx_bytes = []
        var tx_bytes = []
        // 5
        var rd_req = []
        var wr_req = []
        // 6
        var rd_bytes = []
        var wr_bytes = []
        $.ajax({
            type:"POST",
            url:"http://173.26.100.211:9898/instances/"+uuid,
            data:{
                stime:stime,
                etime:etime
            },
            dataType:'JSON',
            success:function(data){
                for(var i in data.message){
                    var item = data.message[i]
                    time.push(item.time)

                    var jstr = item.result
                    jstr = jstr.replace(/u'/g,"'")
                    jstr = jstr.replace(/'/g,"\"")
                    jstr = jstr.replace(/L/g,"")
                    // console.log(jstr)
                    json = JSON.parse(jstr)
                    cpu_usage.push(json.cpu_usage)
                    memory_usage.push((parseFloat(json.memory_usage)/1024).toFixed(2))
                    for(k in json.vir_interfaces){
                        rx_packets.push(json.vir_interfaces[k].rx_packets)
                        tx_packets.push(json.vir_interfaces[k].tx_packets)
                        rx_bytes.push(json.vir_interfaces[k].rx_bytes)
                        tx_bytes.push(json.vir_interfaces[k].tx_bytes)
                    }
                    for(k in json.vir_disks){
                        rd_req.push(json.vir_disks[k].rd_req)
                        wr_req.push(json.vir_disks[k].wr_req)
                        rd_bytes.push(json.vir_disks[k].rd_bytes)
                        wr_bytes.push(json.vir_disks[k].wr_bytes)
                    }
                }
                // 路径配置
                require.config({
                    paths: {
                        echarts: 'http://echarts.baidu.com/build/dist'
                    }
                });
                
                require(
                    [
                        'echarts',
                        'echarts/chart/bar',
                        'echarts/chart/line',
                    ],
                    function (ec) {
                        // CPU使用量
                        var chart1 = ec.init(document.getElementById('chart1')); 
                        chart1.setOption({
                            tooltip : {
                                trigger: 'axis',
                                showDelay: 0,
                                transitionDuration: 0
                            },
                            legend: {
                                data:['CPU使用量']
                            },
                            calculable : true,
                            xAxis : [{
                                name: '时间',
                                type: 'category',
                                data: time
                            }],
                            yAxis : [{
                                name: 'CPU使用量(%)',
                                type: 'value',
                                splitArea: {show: true},
                                axisLabel: {show: true},
                            }],
                            series : [{
                                name: 'CPU使用量',
                                type: 'line',
                                data: cpu_usage,
                                smooth: true,
                                clickable: false,
                                symbol:'none'
                            }]
                        });
                        // 内存使用量
                        var chart2 = ec.init(document.getElementById('chart2'));
                        chart2.setOption({
                            tooltip : {
                                trigger: 'axis',
                                showDelay: 0,
                                transitionDuration: 0
                            },
                            legend: {
                                data:['内存使用量']
                            },
                            calculable : true,
                            xAxis : [{
                                name: '时间',
                                type: 'category',
                                data: time
                            }],
                            yAxis : [{
                                name: '内存使用量(M)',
                                type: 'value',
                                splitArea: {show: true},
                                axisLabel: {show: true},
                            }],
                            series : [{
                                name: '内存使用量',
                                type: 'line',
                                data: memory_usage,
                                smooth: true,
                                clickable: false,
                                symbol:'none'
                            }]
                        });
                        // 网卡流量
                        var chart3 = ec.init(document.getElementById('chart3'));
                        chart3.setOption({
                            tooltip : {
                                trigger: 'axis',
                                showDelay: 0,
                                transitionDuration: 0
                            },
                            legend: {
                                data:['下载流量','上传流量']
                            },
                            calculable : true,
                            xAxis : [{
                                name: '时间',
                                type: 'category',
                                data: time
                            }],
                            yAxis : [{
                                name: '网卡流量(packets)',
                                type: 'value',
                                splitArea: {show: true},
                                axisLabel: {show: true},
                            }],
                            series : [{
                                name: '下载流量',
                                type: 'line',
                                data: rx_packets,
                                smooth: true,
                                clickable: false,
                                symbol:'none'
                            },
                            {
                                name: '上传流量',
                                type: 'line',
                                data: tx_packets,
                                smooth: true,
                                clickable: false,
                                symbol:'none'
                            }]
                        });
                        // 网卡吞吐量
                        var chart4 = ec.init(document.getElementById('chart4'));
                        chart4.setOption({
                            tooltip : {
                                trigger: 'axis',
                                showDelay: 0,
                                transitionDuration: 0
                            },
                            legend: {
                                data:['下载字节数','上传字节数']
                            },
                            calculable : true,
                            xAxis : [{
                                name: '时间',
                                type: 'category',
                                data: time
                            }],
                            yAxis : [{
                                name: '网卡吞吐量(bytes)',
                                type: 'value',
                                splitArea: {show: true},
                                axisLabel: {show: true},
                            }],
                            series : [{
                                name: '下载字节数',
                                type: 'line',
                                data: rx_bytes,
                                smooth: true,
                                clickable: false,
                                symbol:'none'
                            },
                            {
                                name: '上传字节数',
                                type: 'line',
                                data: tx_bytes,
                                smooth: true,
                                clickable: false,
                                symbol:'none'
                            }]
                        });
                        // 硬盘读写
                        var chart5 = ec.init(document.getElementById('chart5'));
                        chart5.setOption({
                            tooltip : {
                                trigger: 'axis',
                                showDelay: 0,
                                transitionDuration: 0
                            },
                            legend: {
                                data:['硬盘读请求','硬盘写请求']
                            },
                            calculable : true,
                            xAxis : [{
                                name: '时间',
                                type: 'category',
                                data: time
                            }],
                            yAxis : [{
                                name: '硬盘读写',
                                type: 'value',
                                splitArea: {show: true},
                                axisLabel: {show: true},
                            }],
                            series : [{
                                name: '硬盘读请求',
                                type: 'line',
                                data: rd_req,
                                smooth: true,
                                clickable: false,
                                symbol:'none'
                            },
                            {
                                name: '硬盘写请求',
                                type: 'line',
                                data: wr_req,
                                smooth: true,
                                clickable: false,
                                symbol:'none'
                            }]
                        });
                        // IO频率
                        var chart6 = ec.init(document.getElementById('chart6'));
                        chart6.setOption({
                            tooltip : {
                                trigger: 'axis',
                                showDelay: 0,
                                transitionDuration: 0
                            },
                            legend: {
                                data:['读出字节','写入字节']
                            },
                            calculable : true,
                            xAxis : [{
                                name: '时间',
                                type: 'category',
                                data: time
                            }],
                            yAxis : [{
                                name: 'IO频率(bytes)',
                                type: 'value',
                                splitArea: {show: true},
                                axisLabel: {show: true},
                            }],
                            series : [{
                                name: '读出字节',
                                type: 'line',
                                data: rd_bytes,
                                smooth: true,
                                clickable: false,
                                symbol:'none'
                            },
                            {
                                name: '写入字节',
                                type: 'line',
                                data: wr_bytes,
                                smooth: true,
                                clickable: false,
                                symbol:'none'
                            }]
                        });
                    }
                );
            }
        })
    </script>
</body>
</html>